{% extends "base.html" %}

{% block title %}Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø­Ø« - {{ app_name }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 mb-0">ğŸ” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø­Ø«</h1>
            <p class="text-muted">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ÙØ±Ø¯ ÙˆØ§Ù„Ù…Ø¬Ù…Ø¹ Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡ÙˆØ§ØªÙ</p>
        </div>
        <div>
            <button class="btn btn-outline-primary" onclick="loadTestNumbers()">
                <i class="fas fa-database me-2"></i>ØªØ­Ù…ÙŠÙ„ Ø£Ø±Ù‚Ø§Ù… ØªØ¬Ø±ÙŠØ¨ÙŠØ©
            </button>
        </div>
    </div>

    <div class="row">
        <!-- Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ÙØ±Ø¯ -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-search me-2"></i>Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ÙØ±Ø¯
                    </h5>
                </div>
                <div class="card-body">
                    <form id="singleSearchForm">
                        <div class="mb-3">
                            <label for="singlePhone" class="form-label">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                            <input type="text" 
                                   class="form-control form-control-lg" 
                                   id="singlePhone" 
                                   placeholder="+9647809394930"
                                   value="+9647809394930">
                            <div class="form-text">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø¨Ø§Ù„ØµÙŠØºØ© Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©</div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary btn-lg w-100" id="singleSearchBtn">
                            <i class="fas fa-search me-2"></i>Ø¨Ø­Ø«
                        </button>
                    </form>
                    
                    <!-- Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ÙØ±Ø¯ -->
                    <div id="singleResult" class="mt-4"></div>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø¬Ù…Ø¹ -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-success text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-list me-2"></i>Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø¬Ù…Ø¹
                    </h5>
                </div>
                <div class="card-body">
                    <form id="bulkSearchForm">
                        <div class="mb-3">
                            <label for="bulkPhones" class="form-label">Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡ÙˆØ§ØªÙ</label>
                            <textarea class="form-control" 
                                      id="bulkPhones" 
                                      rows="6" 
                                      placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… (Ø±Ù‚Ù… ÙˆØ§Ø­Ø¯ ÙÙŠ ÙƒÙ„ Ø³Ø·Ø±)">+9647809394930
+9647801234567
+9647901234567
+9647812345678
+9647823456789</textarea>
                            <div class="form-text">Ø±Ù‚Ù… ÙˆØ§Ø­Ø¯ ÙÙŠ ÙƒÙ„ Ø³Ø·Ø± - Ø­ØªÙ‰ 100 Ø±Ù‚Ù…</div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="maxConcurrent" class="form-label">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ØªØ²Ø§Ù…Ù†Ø©</label>
                                <select class="form-select" id="maxConcurrent">
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3" selected>3</option>
                                    <option value="5">5</option>
                                    <option value="10">10</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="delayBetween" class="form-label">Ø§Ù„ØªØ£Ø®ÙŠØ± (Ø«Ø§Ù†ÙŠØ©)</label>
                                <select class="form-select" id="delayBetween">
                                    <option value="0.5">0.5</option>
                                    <option value="1.0" selected>1.0</option>
                                    <option value="2.0">2.0</option>
                                    <option value="3.0">3.0</option>
                                </select>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-success btn-lg w-100" id="bulkSearchBtn">
                            <i class="fas fa-list me-2"></i>Ø¨Ø­Ø« Ù…Ø¬Ù…Ø¹
                        </button>
                    </form>
                    
                    <!-- ØªÙ‚Ø¯Ù… Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø¬Ù…Ø¹ -->
                    <div id="bulkProgress" class="mt-3" style="display: none;">
                        <div class="progress">
                            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                                 id="bulkProgressBar" 
                                 style="width: 0%"></div>
                        </div>
                        <div class="text-center mt-2">
                            <span id="bulkProgressText">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...</span>
                        </div>
                    </div>
                    
                    <!-- Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø¬Ù…Ø¹ -->
                    <div id="bulkResults" class="mt-4"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø© -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-bar me-2"></i>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¬Ù„Ø³Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-3">
                            <div class="border rounded p-3">
                                <h4 class="text-primary mb-1" id="stat-total">0</h4>
                                <small class="text-muted">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded p-3">
                                <h4 class="text-success mb-1" id="stat-success">0</h4>
                                <small class="text-muted">Ù†Ø¬Ø­</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded p-3">
                                <h4 class="text-danger mb-1" id="stat-failed">0</h4>
                                <small class="text-muted">ÙØ´Ù„</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded p-3">
                                <h4 class="text-info mb-1" id="stat-rate">0%</h4>
                                <small class="text-muted">Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-history me-2"></i>Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª
                    </h5>
                    <button class="btn btn-outline-secondary btn-sm" onclick="clearLog()">
                        <i class="fas fa-trash me-1"></i>Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„
                    </button>
                </div>
                <div class="card-body">
                    <div id="operationLog" class="border rounded p-3" style="max-height: 400px; overflow-y: auto; background-color: #f8f9fa;">
                        <p class="text-muted mb-0">Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø³Ø¬Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Ù…ØªØºÙŠØ±Ø§Øª Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø¬Ù„Ø³Ø©
let sessionStats = {
    total: 0,
    success: 0,
    failed: 0
};

// ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
function updateStats() {
    document.getElementById('stat-total').textContent = sessionStats.total;
    document.getElementById('stat-success').textContent = sessionStats.success;
    document.getElementById('stat-failed').textContent = sessionStats.failed;
    
    const rate = sessionStats.total > 0 ? 
        Math.round((sessionStats.success / sessionStats.total) * 100) : 0;
    document.getElementById('stat-rate').textContent = rate + '%';
}

// Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø³Ø¬Ù„
function addToLog(message, type = 'info') {
    const log = document.getElementById('operationLog');
    const timestamp = new Date().toLocaleTimeString('ar-IQ');
    const icon = {
        'info': 'fas fa-info-circle text-info',
        'success': 'fas fa-check-circle text-success',
        'error': 'fas fa-exclamation-circle text-danger',
        'warning': 'fas fa-exclamation-triangle text-warning'
    }[type] || 'fas fa-info-circle text-info';
    
    const logEntry = document.createElement('div');
    logEntry.className = 'mb-2 p-2 border-bottom';
    logEntry.innerHTML = `
        <span class="text-muted small">[${timestamp}]</span>
        <i class="${icon} me-2"></i>
        ${message}
    `;
    
    // Ø¥Ø¯Ø±Ø§Ø¬ ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰
    if (log.firstChild.tagName) {
        log.insertBefore(logEntry, log.firstChild);
    } else {
        log.innerHTML = '';
        log.appendChild(logEntry);
    }
    
    // Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ 50 Ø±Ø³Ø§Ù„Ø©
    while (log.children.length > 50) {
        log.removeChild(log.lastChild);
    }
}

// Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„
function clearLog() {
    document.getElementById('operationLog').innerHTML = 
        '<p class="text-muted mb-0">ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„...</p>';
}

// ØªØ­Ù…ÙŠÙ„ Ø£Ø±Ù‚Ø§Ù… ØªØ¬Ø±ÙŠØ¨ÙŠØ©
function loadTestNumbers() {
    const testNumbers = [
        '+9647809394930',
        '+9647801234567',
        '+9647901234567',
        '+9647812345678',
        '+9647823456789',
        '+9647834567890',
        '+9647845678901',
        '+9647856789012'
    ];
    
    document.getElementById('bulkPhones').value = testNumbers.join('\n');
    addToLog('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©', 'info');
}

// Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ÙØ±Ø¯
document.getElementById('singleSearchForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const phoneNumber = document.getElementById('singlePhone').value.trim();
    const btn = document.getElementById('singleSearchBtn');
    const resultDiv = document.getElementById('singleResult');
    
    if (!phoneNumber) {
        TRUD.notifications.warning('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ');
        return;
    }
    
    // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø±
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...';
    
    addToLog(`Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…ÙØ±Ø¯ Ø¹Ù†: ${phoneNumber}`, 'info');
    sessionStats.total++;
    updateStats();
    
    try {
        const response = await TRUD.api.post('/search/phone', {
            phone_number: phoneNumber
        });
        
        if (response.success) {
            sessionStats.success++;
            addToLog(`Ù†Ø¬Ø­ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ${phoneNumber} - Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰: ${response.data.names?.[0] || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'}`, 'success');
            
            resultDiv.innerHTML = `
                <div class="alert alert-success">
                    <h6><i class="fas fa-check-circle me-2"></i>ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h6>
                    <div class="row mt-3">
                        <div class="col-sm-6">
                            <strong>Ø§Ù„Ø±Ù‚Ù…:</strong> ${response.data.international || phoneNumber}<br>
                            <strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${response.data.names?.[0] || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}<br>
                            <strong>Ø§Ù„Ù…Ø´ØºÙ„:</strong> ${response.data.carrier || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}
                        </div>
                        <div class="col-sm-6">
                            <strong>Ø§Ù„Ø¨Ù„Ø¯:</strong> ${response.data.country || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}<br>
                            <strong>Ø§Ù„Ù†ÙˆØ¹:</strong> <span class="badge ${response.data.is_spam ? 'bg-warning' : 'bg-success'}">${response.data.is_spam ? 'Ù…Ø²Ø¹Ø¬' : 'Ø¹Ø§Ø¯ÙŠ'}</span><br>
                            <strong>ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©:</strong> ${TRUD.Utils.formatDuration(response.response_time)}
                        </div>
                    </div>
                </div>
            `;
        } else {
            sessionStats.failed++;
            addToLog(`ÙØ´Ù„ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ${phoneNumber}: ${response.error}`, 'error');
            
            resultDiv.innerHTML = `
                <div class="alert alert-warning">
                    <h6><i class="fas fa-exclamation-triangle me-2"></i>Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬</h6>
                    <p class="mb-0">${response.error || 'Ø§Ù„Ø±Ù‚Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª'}</p>
                </div>
            `;
        }
        
    } catch (error) {
        sessionStats.failed++;
        addToLog(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ${phoneNumber}: ${error.message}`, 'error');
        
        resultDiv.innerHTML = `
            <div class="alert alert-danger">
                <h6><i class="fas fa-times-circle me-2"></i>Ø­Ø¯Ø« Ø®Ø·Ø£</h6>
                <p class="mb-0">${error.message}</p>
            </div>
        `;
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-search me-2"></i>Ø¨Ø­Ø«';
        updateStats();
    }
});

// Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø¬Ù…Ø¹
document.getElementById('bulkSearchForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const phonesText = document.getElementById('bulkPhones').value.trim();
    const maxConcurrent = parseInt(document.getElementById('maxConcurrent').value);
    const delayBetween = parseFloat(document.getElementById('delayBetween').value);
    
    const phoneNumbers = phonesText.split('\n')
        .map(line => line.trim())
        .filter(line => line !== '');
    
    if (phoneNumbers.length === 0) {
        TRUD.notifications.warning('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡ÙˆØ§ØªÙ');
        return;
    }
    
    if (phoneNumbers.length > 100) {
        TRUD.notifications.warning('ÙŠÙ…ÙƒÙ† Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† 100 Ø±Ù‚Ù… ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰');
        return;
    }
    
    const btn = document.getElementById('bulkSearchBtn');
    const progressDiv = document.getElementById('bulkProgress');
    const progressBar = document.getElementById('bulkProgressBar');
    const progressText = document.getElementById('bulkProgressText');
    const resultsDiv = document.getElementById('bulkResults');
    
    // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø²Ø± ÙˆØ¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªÙ‚Ø¯Ù…
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...';
    progressDiv.style.display = 'block';
    progressBar.style.width = '0%';
    progressText.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...';
    
    addToLog(`Ø¨Ø¯Ø¡ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø¬Ù…Ø¹ Ø¹Ù† ${phoneNumbers.length} Ø±Ù‚Ù…`, 'info');
    sessionStats.total += phoneNumbers.length;
    updateStats();
    
    try {
        const response = await TRUD.api.post('/search/bulk', {
            phone_numbers: phoneNumbers,
            max_concurrent: maxConcurrent,
            delay_between_requests: delayBetween
        });
        
        sessionStats.success += response.successful_results;
        sessionStats.failed += response.failed_searches;
        
        addToLog(`Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø¬Ù…Ø¹ - Ù†Ø¬Ø­: ${response.successful_results}, ÙØ´Ù„: ${response.failed_searches}`, 'success');
        
        // Ø¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
        progressDiv.style.display = 'none';
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        let resultsHtml = `
            <div class="alert alert-info">
                <h6>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø¬Ù…Ø¹</h6>
                <div class="row mt-3">
                    <div class="col-3">
                        <strong>Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong> ${response.total_searched}
                    </div>
                    <div class="col-3">
                        <strong>Ù†Ø¬Ø­:</strong> <span class="text-success">${response.successful_results}</span>
                    </div>
                    <div class="col-3">
                        <strong>ÙØ´Ù„:</strong> <span class="text-danger">${response.failed_searches}</span>
                    </div>
                    <div class="col-3">
                        <strong>Ø§Ù„Ù…Ø¹Ø¯Ù„:</strong> ${Math.round((response.successful_results / response.total_searched) * 100)}%
                    </div>
                </div>
            </div>
            
            <div class="table-responsive">
                <table class="table table-sm table-striped">
                    <thead class="table-dark">
                        <tr>
                            <th>Ø§Ù„Ø±Ù‚Ù…</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø§Ù„Ù…Ø´ØºÙ„</th>
                            <th>Ø§Ù„ÙˆÙ‚Øª</th>
                            <th>Ø§Ù„Ù†ÙˆØ¹</th>
                        </tr>
                    </thead>
                    <tbody>
        `;
        
        response.results.forEach(result => {
            const statusBadge = result.success ? 
                '<span class="badge bg-success">Ù†Ø¬Ø­</span>' : 
                '<span class="badge bg-danger">ÙØ´Ù„</span>';
            
            const spamBadge = result.data && result.data.is_spam ? 
                '<span class="badge bg-warning">Ù…Ø²Ø¹Ø¬</span>' : 
                '<span class="badge bg-secondary">Ø¹Ø§Ø¯ÙŠ</span>';
            
            resultsHtml += `
                <tr>
                    <td><code>${result.phone_number}</code></td>
                    <td>${statusBadge}</td>
                    <td>${result.data?.names?.[0] || '-'}</td>
                    <td>${result.data?.carrier || '-'}</td>
                    <td>${TRUD.Utils.formatDuration(result.response_time || 0)}</td>
                    <td>${result.success ? spamBadge : '-'}</td>
                </tr>
            `;
        });
        
        resultsHtml += `
                    </tbody>
                </table>
            </div>
        `;
        
        resultsDiv.innerHTML = resultsHtml;
        
    } catch (error) {
        sessionStats.failed += phoneNumbers.length;
        addToLog(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø¬Ù…Ø¹: ${error.message}`, 'error');
        
        progressDiv.style.display = 'none';
        resultsDiv.innerHTML = `
            <div class="alert alert-danger">
                <h6><i class="fas fa-times-circle me-2"></i>Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø¬Ù…Ø¹</h6>
                <p class="mb-0">${error.message}</p>
            </div>
        `;
    } finally {
        btn.disabled = false;
        btn.innerHTML = '<i class="fas fa-list me-2"></i>Ø¨Ø­Ø« Ù…Ø¬Ù…Ø¹';
        updateStats();
    }
});

// ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø© ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ© Ù„Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø­Ø§Ù„Ø©
setInterval(function() {
    if (sessionStats.total > 0) {
        addToLog('ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª', 'info');
    }
}, 30000);
</script>
{% endblock %}